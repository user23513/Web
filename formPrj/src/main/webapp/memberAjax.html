<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>memberAjax.html</title>
<style>
        form {
            border: 2px solid green;
        }

        form>label {
            display: inline-block;
            width: 25%;
            background-color: yellow;
        }
    </style>
</head>
<body>
 <!-- 회원번호, 회원이름, 연락처, 생년월일 -->
    <form action="member" name="memberFrm">
        <label for="memberNo">회원번호</label>
        <input type="number" name="memberNo" id="memberNo" readonly><br>
        
        <label for="memberName">회원이름</label>
        <input type="text" name="memberName" id="memberName"><br>
        
        <label for="phone">연락처</label>
        <input type="text" name="phone" id="phone"><br>
        
        <label for="address">주소</label>
        <input type="text" name="address" id="address"><br>
        
        <label for="birth">생년월일</label>
        <input type="date" name="birth" id="birth"><br>
        
        <label for="image">사진</label>
        <input type="file" name="image" id="image"><br>
        
        <input type="submit" value="추가">
        <input type="reset" value="초기화">
        <input type="button" value="선택삭제">
    </form>
    
    <div id="show">
    	<table border = "1">
    		<thead>
    			<tr>
    				<th>회원번호</th>
    				<th>회원이름</th>
    				<th>연락처</th>
    				<th>주소</th>
    				<th>생년월일</th>
    				<th>사진</th>
    			</tr>
    		</thead>
    		<tbody>
    		
    		</tbody>
    	</table>
    </div>
    
    <script>
    	// 추가버튼 클릭
    	document.forms.memberFrm.addEventListener('submit', function(e){
    		e.preventDefault();
    		console.log(this);
    		let mNO = this.memberNo.value;
    		let mNm = this.memberName.value;
    		let mAr = this.address.value;
    		let mPh = this.phone.value;
    		let mBi = this.birth.value;
			
    		let xhtp = new XMLHttpRequest();
    		xhtp.open('post', 'member'); // 요청방식 post : 매개값이 몸체에 담겨 넣어감.
    		xhtp.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
    		xhtp.send(`cmd=add&name=${mNm}&addr=${mAr}&phone=${mPh}&birth=${mBi}`);
    		xhtp.onload = function(){
    			let result = JSON.parse(this.responseText); // 여기서 this는 xhtp
    			console.log(result);
    			document.querySelector('#show tbody').append(makeTr(result));
    		}
    		
    	})
    	
    	let fields = ['membNo','membName','membPhone','membAddr','membBirth', 'membImage'];
    	function makeTr(member) {
    		let tr = document.createElement('tr');
    		fields.forEach(field => {
    			let td = document.createElement('td');
    			td.innerHTML = member[field];
    			tr.append(td);
    		})
    		return tr;
    	}
    </script>
    
</body>
</html>